!function(e){var t=this.ImageManager={initialize:function(){o=this._getUriObject(window.self.location.href),q=this._getQueryObject(o.query),this.editor=decodeURIComponent(q.e_name),this.fields=new Object,this.fields.url=document.getElementById("f_url"),this.fields.alt=document.getElementById("f_alt"),this.fields.align=document.getElementById("f_align"),this.fields.title=document.getElementById("f_title"),this.fields.caption=document.getElementById("f_caption"),this.fields.c_class=document.getElementById("f_caption_class"),this.folderlist=document.getElementById("folderlist"),this.frame=window.frames.imageframe,this.frameurl=this.frame.location.href,this.imageframe=document.getElementById("imageframe"),this.imageframe.manager=this,e(this.imageframe).on("load",function(){t.onloadimageview()}),this.upbutton=document.getElementById("upbutton"),e(this.upbutton).off("click"),e(this.upbutton).on("click",function(){t.upFolder()})},onloadimageview:function(){this.frameurl=this.frame.location.href;for(var t=this.getImageFolder(),i=0;i<this.folderlist.length;i++)if(t==this.folderlist.options[i].value){this.folderlist.selectedIndex=i,e(this.folderlist.className).hasClass("chzn-done")&&e(this.folderlist).trigger("liszt:updated");break}a=this._getUriObject(e("#uploadForm").attr("action")),q=this._getQueryObject(a.query),q.folder=t;var l=[];for(var r in q){var s=q[r];q.hasOwnProperty(r)&&null!==s&&l.push(r+"="+s)}a.query=l.join("&");var n="";"undefined"!=typeof a.port&&80!=a.port&&(n=":"+a.port),e("#uploadForm").attr("action",a.scheme+"://"+a.domain+n+a.path+"?"+a.query)},getImageFolder:function(){var e=this.frame.location.search.substring(1),t=this.parseQuery(e);return t.folder},onok:function(){var e="",t="",i=this.fields.url.value,l=this.fields.alt.value,r=this.fields.align.value,s=this.fields.title.value,a=this.fields.caption.value,n=this.fields.c_class.value;if(""!=i&&(""!=l?t=t+'alt="'+l+'" ':t+='alt="" ',""!=r&&""==a&&(t=t+'class="pull-'+r+'" '),""!=s&&(t=t+'title="'+s+'" '),e='<img src="'+i+'" '+t+"/>",""!=a)){var o="",f="";""!=r&&(o=' class="pull-'+r+'"'),""!=n&&(f=' class="'+n+'"'),e="<figure"+o+">"+e+"<figcaption"+f+">"+a+"</figcaption></figure>"}return window.parent.jInsertEditorText(e,this.editor),!1},setFolder:function(t,i,l){for(var r=0;r<this.folderlist.length;r++)if(t==this.folderlist.options[r].value){this.folderlist.selectedIndex=r,e(this.folderlist.className).hasClass("chzn-done")&&e(this.folderlist).trigger("liszt:updated");break}this.frame.location.href="index.php?option=com_media&view=imagesList&tmpl=component&folder="+t+"&asset="+i+"&author="+l},getFolder:function(){return this.folderlist.value},upFolder:function(){var e=this.getFolder();if(e.length<2)return!1;for(var t=e.split("/"),i="",l=0;l<t.length-1;l++)i+=t[l],i+="/";i=i.substring(0,i.length-1);for(var l=0;l<this.folderlist.length;l++){var r=this.folderlist.options[l].value;if(r==i){this.folderlist.selectedIndex=l;var s=this.folderlist.options[l].value;this.setFolder(s);break}}},populateFields:function(t){e("#f_url").val(image_base_path+t)},showMessage:function(e){var t=document.id("message"),i=document.id("messages");t.firstChild&&t.removeChild(t.firstChild),t.appendChild(document.createTextNode(e)),i.style.display="block"},parseQuery:function(e){var t=new Object;if(!e)return t;for(var i=e.split(/[;&]/),l=0;l<i.length;l++){var r=i[l].split("=");if(r&&2==r.length){var s=unescape(r[0]),a=unescape(r[1]).replace(/\+ /g," ");t[s]=a}}return t},refreshFrame:function(){this._setFrameUrl()},_setFrameUrl:function(e){null!=e&&(this.frameurl=e),this.frame.location.href=this.frameurl},_getQueryObject:function(e){var t=e.split(/[&;]/),i={};return t.length&&t.forEach(function(e){var t=e.split("=");t.length&&2==t.length&&(i[encodeURIComponent(t[0])]=encodeURIComponent(t[1]))}),i},_getUriObject:function(e){var t={},i=e.match(/^(?:([^:\/?#.]+):)?(?:\/\/)?(([^:\/?#]*)(?::(\d*))?)((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[\?#]|$)))*\/?)?([^?#\/]*))?(?:\?([^#]*))?(?:#(.*))?/);return["uri","scheme","authority","domain","port","path","directory","file","query","fragment"].forEach(function(e,l){t[e]=i[l]}),i?t:null}}}(jQuery),jQuery(function(){ImageManager.initialize()});