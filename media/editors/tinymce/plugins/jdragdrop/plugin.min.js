tinymce.PluginManager.add("jdragdrop",function(e){function t(t){var r=new FormData;r.append("Filedata",t),r.append("folder",mediaUploadPath),jQuery.ajax({url:uploadUri,type:"post",enctype:"multipart/form-data",data:r,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=jQuery.ajaxSettings.xhr();return e},success:function(t){if(0==t.status&&tinyMCE.activeEditor.windowManager.alert(t.message+": "+setCustomDir+t.location),1==t.status){var r=tinyMCE.activeEditor.getDoc().createElement("img");r.src=setCustomDir+t.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,r.outerHTML)}setTimeout(function(){jQuery("#jloader").remove(),e.contentAreaContainer.style.borderWidth=""},200)},error:function(){setTimeout(function(){jQuery("#jloader").remove(),e.contentAreaContainer.style.borderWidth=""},100)}})}tinyMCE.DOM.bind(document,"dragleave",function(e){return e.stopPropagation(),e.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="",!1}),"undefined"!=typeof FormData?(e.on("dragenter",function(e){return e.stopPropagation(),!1}),e.on("dragover",function(e){return e.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderColor="green",tinyMCE.activeEditor.contentAreaContainer.style.borderStyle="dashed",tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="5px",!1}),e.on("drop",function(r){if(r.dataTransfer&&r.dataTransfer.files&&r.dataTransfer.files.length>0)for(var n,a=0;n=r.dataTransfer.files[a];a++)n.name.match(/\.(jpg|jpeg|png|gif|bmp)$/)&&(jQuery(".mce-toolbar-grp").append('<div id="jloader">   <div class="progress progress-success progress-striped active" style="width:100%;height:30px;">       <div class="bar" style="width: 100%"></div>   </div></div>'),e.contentAreaContainer.style.borderWidth="",t(n),r.preventDefault());e.contentAreaContainer.style.borderWidth=""})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),e.on("drop",function(e){return e.preventDefault(),!1}))});