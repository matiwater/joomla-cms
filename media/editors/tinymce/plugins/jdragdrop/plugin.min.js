tinymce.PluginManager.add("jdragdrop",function(t){function e(e){var n=new FormData;n.append("Filedata",e),n.append("folder",mediaUploadPath),jQuery.ajax({url:uploadUri,type:"post",enctype:"multipart/form-data",data:n,cache:!1,contentType:!1,processData:!1,xhr:function(){var t=jQuery.ajaxSettings.xhr();return t},success:function(e){if(0==e.status&&tinyMCE.activeEditor.windowManager.alert(e.message+": "+setCustomDir+e.location),1==e.status){var n=tinyMCE.activeEditor.getDoc().createElement("img");n.src=setCustomDir+e.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,n.outerHTML)}setTimeout(function(){t.getBody().style.backgroundRepeat="",t.getBody().style.backgroundPositionX="",t.getBody().style.backgroundPositionY="",t.getBody().style.backgroundImage="",t.contentAreaContainer.style.borderWidth=""},200)},error:function(){setTimeout(function(){t.getBody().style.backgroundRepeat="",t.getBody().style.backgroundPositionX="",t.getBody().style.backgroundPositionY="",t.getBody().style.backgroundImage="",t.contentAreaContainer.style.borderWidth=""},100)}})}tinyMCE.DOM.bind(document,"dragleave",function(t){return t.stopPropagation(),t.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="",!1}),"undefined"!=typeof FormData?(t.on("dragenter",function(t){return t.stopPropagation(),!1}),t.on("dragover",function(t){return t.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderColor="green",tinyMCE.activeEditor.contentAreaContainer.style.borderStyle="dashed",tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="5px",!1}),t.on("drop",function(n){if(n.dataTransfer&&n.dataTransfer.files&&n.dataTransfer.files.length>0)for(var o,r=0;o=n.dataTransfer.files[r];r++)o.name.match(/\.(jpg|jpeg|png|gif|bmp)$/)&&(t.getBody().style.backgroundRepeat="no-repeat",t.getBody().style.backgroundPositionX="50%",t.getBody().style.backgroundPositionY="150px",t.getBody().style.backgroundImage="url(/media/jui/images/ajax-loader.gif)",t.contentAreaContainer.style.borderWidth="",e(o),n.preventDefault());t.contentAreaContainer.style.borderWidth=""})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),t.on("drop",function(t){return t.preventDefault(),!1}))});