tinymce.PluginManager.add("jdragdrop",function(e){function t(e){var t=new FormData;t.append("Filedata",e),t.append("folder",mediaUploadPath),jQuery.ajax({url:uploadUri,type:"post",enctype:"multipart/form-data",data:t,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=jQuery.ajaxSettings.xhr();return e},success:function(e){if(0==e.status&&tinyMCE.activeEditor.windowManager.alert(e.message+": "+setCustomDir+e.location),1==e.status){var t=tinyMCE.activeEditor.getDoc().createElement("img");t.src=setCustomDir+e.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,t.outerHTML)}setTimeout(function(){jQuery("#jloader").remove()},200)},error:function(){setTimeout(function(){jQuery("#jloader").remove()},100)}})}tinyMCE.DOM.bind(document,"dragleave",function(e){return e.stopPropagation(),e.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="",!1}),"undefined"!=typeof FormData?(e.on("dragenter",function(e){return e.stopPropagation(),!1}),e.on("dragover",function(e){return e.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderColor="green",tinyMCE.activeEditor.contentAreaContainer.style.borderStyle="dashed",tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="5px",!1}),e.on("drop",function(r){if(r.dataTransfer&&r.dataTransfer.files&&r.dataTransfer.files.length>0)for(var n,a=0;n=r.dataTransfer.files[a];a++)n.name.match(/\.(jpg|jpeg|png|gif|bmp)$/)&&(e.contentAreaContainer.style.borderWidth="",jQuery('<div id="jloader" />').css({position:"absolute",width:"100%",height:"100%",left:0,top:0,opacity:.55,zIndex:1e6,background:"url(/media/jui/images/ajax-loader.gif) #fff no-repeat 50% 50%"}).appendTo(jQuery(".editor").css("position","relative")),e.contentAreaContainer.style.borderWidth="",t(n),r.preventDefault());e.contentAreaContainer.style.borderWidth=""})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),e.on("drop",function(e){return e.preventDefault(),!1}))});