tinymce.PluginManager.add("joomlaimage", function(editor, url) {
	editor.addButton("joomlaimage", {
		text: 'J Image',
		title: "Joomla Insert Image",
		icon: "image",
		onclick: function() {
			if (imgLink) {
				editor.windowManager.open({
					title  : "Change or upload image",
					url    : imgLink + editor.getContainer().id,
					width  : 900,
					height : 600,
					buttons: [{
						text   : "Insert",
						onclick: function () {
							var url = editor.windowManager.getWindows()[0];
							editor.insertContent("<img src=\"" + url.getContentWindow().document.getElementById("f_url").value + "\" alt=\"\" />"), url.close()
						}
					}, {
						text   : "Close",
						onclick: "close"
					}]
				})
			}
		}
	}), editor.addMenuItem("joomlaimage", {
		title: "Joomla Insert Image",
		context: "insert",
		icon: "image",
		onclick: function() {
			if (imgLink) {
				editor.windowManager.open({
					title  : "Change or upload image",
					url    : imgLink + editor.getContainer().id,
					width  : 900,
					height : 600,
					buttons: [{
						text   : "Insert",
						onclick: function () {
							var url = editor.windowManager.getWindows()[0];
							editor.insertContent("<img src=\"" + url.getContentWindow().document.getElementById("f_url").value + "\" alt=\"\" />"), url.close()
						}
					}, {
						text   : "Close",
						onclick: "close"
					}]
				})
			}
		}
	})
});